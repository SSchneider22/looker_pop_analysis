# How to Method3

方法３に関して、まとめる。

## 引用元
https://help.looker.com/hc/en-us/articles/360050104194-Methods-for-Period-Over-Period-PoP-Analysis-in-Looker

## 概要
この方法では、ユーザーが現在選択されている期間の直前の同じ長さの期間である「前の期間」を選択することができます。

この方法は、方法2:ユーザーがパラメータを使用して期間を選択できるようにする、と似たアプローチを使用しますが、適切な日付の時間枠を選択するためにパラメータを使用するのではなく、正しい直前の期間のロジックは、Liquidを使用して定義されています。

## メリット・デメリット

### メリット
- 方法 2 と同じ機能を実行します。
- フィルタリングされたメジャーをサポートします。
- ユーザーを混乱させる可能性のある、あまりにも多くのフィールドを必要とせずに、期間定義のきめ細かな制御を提供します。

### デメリット
- Liquidの実装を含む複雑なLookMLモデリングが必要です。
- 対象の期間が重複する場合はサポートされていません（これには結合が必要です）。
- 単一の日付フィールドのみを使用することができます（例えば、他の日付フィールドと同じ機能を使用するには、日付フィールドごとにすべてのコードを複製する必要があります）。

## LookML実装手順
1. ユーザーが現在の期間を選択するためのフィルターフィールドを作成します。以下のLookMLの例のcurrent_date_rangeフィールドを参照してください。
  - 選択した日付範囲外の日付を除外するために、SQLパラメータをフィルタに適用します。
2. 過去の期間タイプ（例：前週、前々年など）を選択するためのパラメータを作成します。以下のLookMLの例のcompare_toパラメータを参照してください。
3. 期間を計算するための助けとなるディメンションを作成します。
  - 現在の期間の日数を計算するディメンジョンを作成します。以下の LookMLの例で、"HIDDEN HELPER DIMENSIONS"の下にあるdays_in_periodディメンジョンを参照してください。
  - 前の期間の開始日と終了日を計算するディメンジョンを作成します。以下の LookML の例の HIDDEN HELPER DIMENSIONS の下にある period_2_start ディメンジョンと period_2_end ディメンジョンを参照してください。
  - 現在の期間と前の期間（1 日目、2 日目...）の各日の序数値を計算して、2 つの期間を "並べる" ためのディメンジョンを作成します。以下の LookML の例の HIDDEN HELPER DIMENSIONS の下にある day_in_period ディメンジョンを参照してください。
  - (オプション) ピボット列を正しく並べ替えるためのディメンジョンを作成します。以下の LookML の例の HIDDEN HELPER DIMENSIONS の下にある order_for_period ディメンジョンを参照してください。
  - (オプション) フィルタリングされたメジャーで使用する静的ラベルを提供するディメンジョンを作成します。以下の LookML 例の TO CREATE FILTERED MEASURES にある period_filtered_measures を参照してください。

## グラフ作成手順
1. 「PoP Method 3: Custom choice of current and previous periods with parameters」のExploreを起動
2.　ディメンション「Period」をグラフに入れる※比率を出したいときには、不要。
3.　比較したいメジャーを入れる
